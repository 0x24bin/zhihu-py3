<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.12: http://docutils.sourceforge.net/" />
<title>zhihu-py3 : 知乎非官方API库 with Python3</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7614 2013-02-21 15:55:51Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="zhihu-py3-api-with-python3">
<h1 class="title">zhihu-py3 : 知乎非官方API库 with Python3</h1>

<p><a class="reference external" href="https://readthedocs.org/projects/zhihu-py3/?badge=latest"><img alt="Documentation Status" src="https://readthedocs.org/projects/zhihu-py3/badge/?version=latest" /></a></p>
<p>最近一次更新内容：</p>
<p>发布到Pypi。</p>
<p>具体请看<a class="reference external" href="https://github.com/7sDream/zhihu-py3/blob/master/ChangeLog.md">ChangeLog</a>。</p>
<p><strong>有问题请开Issue，几个小时后无回应可加最后面的QQ群询问。</strong></p>
<div class="section" id="id1">
<h1>功能</h1>
<p>由于知乎没有公开API，加上受到<a class="reference external" href="https://github.com/egrcc/zhihu-python">zhihu-python</a>项目的启发，在Python3下重新写了一个知乎的数据解析模块。</p>
<p>提供的功能一句话概括为，用户提供知乎的网址构用于建对应类的对象，可以获取到某些需要的数据。</p>
<p>简单例子：</p>
<pre class="code python literal-block">
<span class="keyword namespace">from</span> <span class="name namespace">zhihu</span> <span class="keyword namespace">import</span> <span class="name">ZhihuClient</span>

<span class="name">Cookies_File</span> <span class="operator">=</span> <span class="literal string">'cookies.json'</span>

<span class="name">client</span> <span class="operator">=</span> <span class="name">ZhihuClient</span><span class="punctuation">(</span><span class="name">Cookies_File</span><span class="punctuation">)</span>

<span class="name">url</span> <span class="operator">=</span> <span class="literal string">'http://www.zhihu.com/question/24825703'</span>
<span class="name">question</span> <span class="operator">=</span> <span class="name">client</span><span class="operator">.</span><span class="name">question</span><span class="punctuation">(</span><span class="name">url</span><span class="punctuation">)</span>

<span class="keyword">print</span><span class="punctuation">(</span><span class="name">question</span><span class="operator">.</span><span class="name">title</span><span class="punctuation">)</span>
<span class="keyword">print</span><span class="punctuation">(</span><span class="name">question</span><span class="operator">.</span><span class="name">answer_num</span><span class="punctuation">)</span>
<span class="keyword">print</span><span class="punctuation">(</span><span class="name">question</span><span class="operator">.</span><span class="name">follower_num</span><span class="punctuation">)</span>
<span class="keyword">print</span><span class="punctuation">(</span><span class="name">question</span><span class="operator">.</span><span class="name">topics</span><span class="punctuation">)</span>

<span class="keyword">for</span> <span class="name">answer</span> <span class="operator word">in</span> <span class="name">question</span><span class="operator">.</span><span class="name">answers</span><span class="punctuation">:</span>
    <span class="keyword">print</span><span class="punctuation">(</span><span class="name">answer</span><span class="operator">.</span><span class="name">author</span><span class="operator">.</span><span class="name">name</span><span class="punctuation">,</span> <span class="name">answer</span><span class="operator">.</span><span class="name">upvote_num</span><span class="punctuation">)</span>
</pre>
<p>这段代码的输出为：</p>
<pre class="literal-block">
关系亲密的人之间要说「谢谢」吗？
627
4322
['心理学', '恋爱', '社会', '礼仪', '亲密关系']
龙晓航 50
小不点儿 198
芝士就是力量 89
欧阳忆希 425
...
</pre>
<p>另外还有<tt class="docutils literal">Author（用户）</tt>、<tt class="docutils literal">Answer（答案）</tt>、<tt class="docutils literal">Collection（收藏夹）</tt>、<tt class="docutils literal">Column（专栏）</tt>、<tt class="docutils literal">Post（文章）</tt>、<tt class="docutils literal">Topic（话题）</tt>等类可以使用，<tt class="docutils literal">Answer</tt>,<tt class="docutils literal">Post</tt>类提供了<tt class="docutils literal">save</tt>方法能将答案或文章保存为HTML或Markdown格式，具体请看文档，或者<tt class="docutils literal"><span class="pre">zhihu-test.py</span></tt>。</p>
</div>
<div class="section" id="id2">
<h1>安装</h1>
<p class="bold">本项目依赖于<a class="reference external" href="https://pypi.python.org/pypi/requests/2.7.0">requests</a>、<a class="reference external" href="http://www.crummy.com/software/BeautifulSoup">BeautifulSoup4</a>、<a class="reference external" href="https://github.com/aaronsw/html2text">html2text</a></p>
<p>已将项目发布到pypi，请使用下列命令安装</p>
<pre class="code bash literal-block">
<span class="operator">(</span>sudo<span class="operator">)</span> pip3 install zhihu-py3
</pre>
<p>希望开启lxml的话请使用：</p>
<pre class="code bash literal-block">
<span class="operator">(</span>sudo<span class="operator">)</span> pip3 install zhihu-py3<span class="operator">[</span>lxml<span class="operator">]</span>
</pre>
<p>因为lxml解析html效率高而且容错率强，在知乎使用<tt class="docutils literal">&lt;br&gt;</tt>时，自带的html.parser会将其转换成<tt class="docutils literal"><span class="pre">&lt;br&gt;...&lt;/br&gt;</span></tt>，而lxml则转换为<tt class="docutils literal">&lt;br/&gt;</tt>，更为标准且美观，所以推荐使用第二个命令。</p>
<p>不安装lxml也能使用本模块，此时会自动使用html.parser作为解析器。</p>
<p>PS 若在安装lxml时出错，请安装libxml和libxslt后重试：</p>
<pre class="code bash literal-block">
sudo apt-get install libxml2 libxml2-dev libxslt1.1 libxslt1-dev
</pre>
</div>
<div class="section" id="id3">
<h1>准备工作</h1>
<p>第一次使用推荐运行以下代码生成 cookies 文件：</p>
<pre class="code python literal-block">
<span class="keyword namespace">from</span> <span class="name namespace">zhihu</span> <span class="keyword namespace">import</span> <span class="name">ZhihuClient</span>

<span class="name">ZhihuClient</span><span class="punctuation">()</span><span class="operator">.</span><span class="name">create_cookies</span><span class="punctuation">(</span><span class="literal string">'cookies.json'</span><span class="punctuation">)</span>
</pre>
<p>运行结果</p>
<pre class="literal-block">
====== zhihu login =====
email: &lt;your-email&gt;
password: &lt;your-password&gt;
please check captcha.gif for captcha
captcha: &lt;captcha-code&gt;
====== logging.... =====
login successfully
cookies file created.
</pre>
<p>运行成功后会在目录下生成<tt class="docutils literal">cookies.json</tt>文件。</p>
<p>以下示例皆以登录成功为前提。</p>
<p>建议在正式使用之前运行<tt class="docutils literal"><span class="pre">zhihu-test.py</span></tt>测试一下。</p>
</div>
<div class="section" id="id4">
<h1>用法实例</h1>
<p>以下示例均显示了使用cookies文件（上文生成）的登录方式，其他登录方式见后。</p>
<div class="section" id="id5">
<h2>获取某用户的基本信息</h2>
<pre class="code python literal-block">
<span class="keyword namespace">from</span> <span class="name namespace">zhihu</span> <span class="keyword namespace">import</span> <span class="name">ZhihuClient</span>

<span class="name">Cookies_File</span> <span class="operator">=</span> <span class="literal string">'cookies.json'</span>

<span class="name">client</span> <span class="operator">=</span> <span class="name">ZhihuClient</span><span class="punctuation">(</span><span class="name">Cookies_File</span><span class="punctuation">)</span>

<span class="name">url</span> <span class="operator">=</span> <span class="literal string">'http://www.zhihu.com/people/zord-vczh'</span>
<span class="name">author</span> <span class="operator">=</span> <span class="name">client</span><span class="operator">.</span><span class="name">author</span><span class="punctuation">(</span><span class="name">url</span><span class="punctuation">)</span>

<span class="keyword">print</span><span class="punctuation">(</span><span class="literal string">'用户名 </span><span class="literal string interpol">%s</span><span class="literal string">'</span> <span class="operator">%</span> <span class="name">author</span><span class="operator">.</span><span class="name">name</span><span class="punctuation">)</span>
<span class="keyword">print</span><span class="punctuation">(</span><span class="literal string">'用户简介 </span><span class="literal string interpol">%s</span><span class="literal string">'</span> <span class="operator">%</span> <span class="name">author</span><span class="operator">.</span><span class="name">motto</span><span class="punctuation">)</span>
<span class="keyword">print</span><span class="punctuation">(</span><span class="literal string">'用户关注人数 </span><span class="literal string interpol">%d</span><span class="literal string">'</span> <span class="operator">%</span> <span class="name">author</span><span class="operator">.</span><span class="name">followee_num</span><span class="punctuation">)</span>
<span class="keyword">print</span><span class="punctuation">(</span><span class="literal string">'取用户粉丝数 </span><span class="literal string interpol">%d</span><span class="literal string">'</span> <span class="operator">%</span> <span class="name">author</span><span class="operator">.</span><span class="name">follower_num</span><span class="punctuation">)</span>
<span class="keyword">print</span><span class="punctuation">(</span><span class="literal string">'用户得到赞同数 </span><span class="literal string interpol">%d</span><span class="literal string">'</span> <span class="operator">%</span> <span class="name">author</span><span class="operator">.</span><span class="name">upvote_num</span><span class="punctuation">)</span>
<span class="keyword">print</span><span class="punctuation">(</span><span class="literal string">'用户得到感谢数 </span><span class="literal string interpol">%d</span><span class="literal string">'</span> <span class="operator">%</span> <span class="name">author</span><span class="operator">.</span><span class="name">thank_num</span><span class="punctuation">)</span>
<span class="keyword">print</span><span class="punctuation">(</span><span class="literal string">'用户提问数 </span><span class="literal string interpol">%d</span><span class="literal string">'</span> <span class="operator">%</span> <span class="name">author</span><span class="operator">.</span><span class="name">question_num</span><span class="punctuation">)</span>
<span class="keyword">print</span><span class="punctuation">(</span><span class="literal string">'用户答题数 </span><span class="literal string interpol">%d</span><span class="literal string">'</span> <span class="operator">%</span> <span class="name">author</span><span class="operator">.</span><span class="name">answer_num</span><span class="punctuation">)</span>

<span class="keyword">print</span><span class="punctuation">(</span><span class="literal string">'用户专栏文章数 </span><span class="literal string interpol">%d</span><span class="literal string">，名称分别为：'</span> <span class="operator">%</span> <span class="name">author</span><span class="operator">.</span><span class="name">post_num</span><span class="punctuation">)</span>
<span class="keyword">for</span> <span class="name">column</span> <span class="operator word">in</span> <span class="name">author</span><span class="operator">.</span><span class="name">columns</span><span class="punctuation">:</span>
    <span class="keyword">print</span><span class="punctuation">(</span><span class="name">column</span><span class="operator">.</span><span class="name">name</span><span class="punctuation">)</span>
<span class="keyword">print</span><span class="punctuation">(</span><span class="literal string">'用户收藏夹数 </span><span class="literal string interpol">%d</span><span class="literal string">，名称分别为：'</span> <span class="operator">%</span> <span class="name">author</span><span class="operator">.</span><span class="name">collection_num</span><span class="punctuation">)</span>
<span class="keyword">for</span> <span class="name">collection</span> <span class="operator word">in</span> <span class="name">author</span><span class="operator">.</span><span class="name">collections</span><span class="punctuation">:</span>
    <span class="keyword">print</span><span class="punctuation">(</span><span class="name">collection</span><span class="operator">.</span><span class="name">name</span><span class="punctuation">)</span>
</pre>
<p>结果：</p>
<pre class="literal-block">
用户名 vczh
用户简介 专业造轮子 https://github.com/vczh-libraries
用户关注人数 1339
取用户粉丝数 128100
用户得到赞同数 320326
用户得到感谢数 43045
用户提问数 238
用户答题数 8392
用户专栏文章数 25，名称分别为：
vczh的日常
深井冰 IT 评论
编程语言与高级语言虚拟机杂谈（仮）
蓝色小药丸
用户收藏夹数 1，名称分别为：
李老师牛逼的答案
</pre>
<p>为节省篇幅，后文例子构建<tt class="docutils literal">client</tt>的代码省略，因为都一样。</p>
</div>
<div class="section" id="id6">
<h2>备份某问题所有答案</h2>
<pre class="code python literal-block">
<span class="name">question</span> <span class="operator">=</span> <span class="name">client</span><span class="operator">.</span><span class="name">question</span><span class="punctuation">(</span><span class="literal string">'http://www.zhihu.com/question/28092572'</span><span class="punctuation">)</span>
<span class="keyword">for</span> <span class="name">answer</span> <span class="operator word">in</span> <span class="name">question</span><span class="operator">.</span><span class="name">answers</span><span class="punctuation">:</span>
    <span class="name">answer</span><span class="operator">.</span><span class="name">save</span><span class="punctuation">()</span>
</pre>
<p>会在当前目录下新建以问题标题命名的文件夹，并将所有html文件保存到该文件夹。</p>
<p><tt class="docutils literal">save</tt>函数默认目录为当前目录下以问题标题命名的目录，默认文件名为问题标题加上答题者昵称，有相同昵称的情况下自动加上序号。</p>
<pre class="code python literal-block">
<span class="name">answer</span><span class="operator">.</span><span class="name">save</span><span class="punctuation">(</span><span class="name">mode</span><span class="operator">=</span><span class="literal string">&quot;md&quot;</span><span class="punctuation">)</span>
</pre>
<p>将会导出为 markdown 格式，下同。</p>
</div>
<div class="section" id="id7">
<h2>备份某用户所有答案</h2>
<pre class="code python literal-block">
<span class="name">author</span> <span class="operator">=</span> <span class="name">client</span><span class="operator">.</span><span class="name">author</span><span class="punctuation">(</span><span class="literal string">'http://www.zhihu.com/people/7sdream'</span><span class="punctuation">)</span>
<span class="keyword">for</span> <span class="name">answer</span> <span class="operator word">in</span> <span class="name">author</span><span class="operator">.</span><span class="name">answers</span><span class="punctuation">:</span>
    <span class="name">answer</span><span class="operator">.</span><span class="name">save</span><span class="punctuation">(</span><span class="name">filepath</span><span class="operator">=</span><span class="name">author</span><span class="operator">.</span><span class="name">name</span><span class="punctuation">)</span>
</pre>
<p>备份某收藏夹所有答案，备份专栏文章同理，不再举例。</p>
</div>
<div class="section" id="id8">
<h2>获取某用户点赞的动态</h2>
<pre class="code python literal-block">
<span class="name">author</span> <span class="operator">=</span> <span class="name">zhihu</span><span class="operator">.</span><span class="name">author</span><span class="punctuation">(</span><span class="literal string">'http://www.zhihu.com/people/zord-vczh'</span><span class="punctuation">)</span>
<span class="keyword">for</span> <span class="name">act</span> <span class="operator word">in</span> <span class="name">author</span><span class="operator">.</span><span class="name">activities</span><span class="punctuation">:</span>
    <span class="keyword">if</span> <span class="name">act</span><span class="operator">.</span><span class="name">type</span> <span class="operator">==</span> <span class="name">zhihu</span><span class="operator">.</span><span class="name">ActType</span><span class="operator">.</span><span class="name">UPVOTE_ANSWER</span><span class="punctuation">:</span>
        <span class="keyword">print</span><span class="punctuation">(</span><span class="literal string">'</span><span class="literal string interpol">%s</span><span class="literal string"> 在 </span><span class="literal string interpol">%s</span><span class="literal string"> 赞同了问题 </span><span class="literal string interpol">%s</span><span class="literal string"> 中 </span><span class="literal string interpol">%s</span><span class="literal string">(motto: </span><span class="literal string interpol">%s</span><span class="literal string">) 的回答, '</span>
              <span class="literal string">'此回答赞同数 </span><span class="literal string interpol">%d</span><span class="literal string">'</span> <span class="operator">%</span>
              <span class="punctuation">(</span><span class="name">author</span><span class="operator">.</span><span class="name">name</span><span class="punctuation">,</span> <span class="name">act</span><span class="operator">.</span><span class="name">time</span><span class="punctuation">,</span> <span class="name">act</span><span class="operator">.</span><span class="name">answer</span><span class="operator">.</span><span class="name">question</span><span class="operator">.</span><span class="name">title</span><span class="punctuation">,</span>
               <span class="name">act</span><span class="operator">.</span><span class="name">answer</span><span class="operator">.</span><span class="name">author</span><span class="operator">.</span><span class="name">name</span><span class="punctuation">,</span> <span class="name">act</span><span class="operator">.</span><span class="name">answer</span><span class="operator">.</span><span class="name">author</span><span class="operator">.</span><span class="name">motto</span><span class="punctuation">,</span>
               <span class="name">act</span><span class="operator">.</span><span class="name">answer</span><span class="operator">.</span><span class="name">upvote_num</span><span class="punctuation">))</span>
</pre>
<p>结果</p>
<pre class="literal-block">
vczh 在 2015-07-24 08:35:06 赞同了问题 女生夏天穿超短裙是一种什么样的体验？ 中 Light(motto: 我城故事多。) 的回答, 此回答赞同数 43
vczh 在 2015-07-24 08:34:30 赞同了问题 女生夏天穿超短裙是一种什么样的体验？ 中 Ms狐狸(motto: 随便写来玩玩) 的回答, 此回答赞同数 57
……
</pre>
<p>用户activities属性的完整用法可查看<tt class="docutils literal"><span class="pre">zhihu-test.py</span></tt>中<tt class="docutils literal">test_author</tt>函数</p>
</div>
<div class="section" id="id9">
<h2>获取用户关注的人和关注此用户的人</h2>
<pre class="code python literal-block">
<span class="name">author</span> <span class="operator">=</span> <span class="name">client</span><span class="operator">.</span><span class="name">author</span><span class="punctuation">(</span><span class="literal string">'http://www.zhihu.com/people/7sdream'</span><span class="punctuation">)</span>

<span class="keyword">print</span><span class="punctuation">(</span><span class="literal string">'--- Followers ---'</span><span class="punctuation">)</span>
<span class="keyword">for</span> <span class="name">follower</span> <span class="operator word">in</span> <span class="name">author</span><span class="operator">.</span><span class="name">followers</span><span class="punctuation">:</span>
    <span class="keyword">print</span><span class="punctuation">(</span><span class="name">follower</span><span class="operator">.</span><span class="name">name</span><span class="punctuation">)</span>

<span class="keyword">print</span><span class="punctuation">(</span><span class="literal string">'--- Followees ---'</span><span class="punctuation">)</span>
<span class="keyword">for</span> <span class="name">followee</span> <span class="operator word">in</span> <span class="name">author</span><span class="operator">.</span><span class="name">followees</span><span class="punctuation">:</span>
    <span class="keyword">print</span><span class="punctuation">(</span><span class="name">followee</span><span class="operator">.</span><span class="name">name</span><span class="punctuation">)</span>
</pre>
<p>结果：</p>
<pre class="literal-block">
--- Followers ---
yuwei
falling
周非
...
--- Followees ---
yuwei
falling
伍声
...
</pre>
</div>
<div class="section" id="id10">
<h2>计算某答案点赞中三零用户比例</h2>
<pre class="code python literal-block">
<span class="name">url</span> <span class="operator">=</span> <span class="literal string">'http://www.zhihu.com/question/30404450/answer/47939822'</span>
<span class="name">answer</span> <span class="operator">=</span> <span class="name">client</span><span class="operator">.</span><span class="name">answer</span><span class="punctuation">(</span><span class="name">url</span><span class="punctuation">)</span>

<span class="name">three_zero_user_num</span> <span class="operator">=</span> <span class="literal number integer">0</span>

<span class="keyword">for</span> <span class="name">upvoter</span> <span class="operator word">in</span> <span class="name">answer</span><span class="operator">.</span><span class="name">upvoters</span><span class="punctuation">:</span>
    <span class="keyword">print</span><span class="punctuation">(</span><span class="name">upvoter</span><span class="operator">.</span><span class="name">name</span><span class="punctuation">,</span> <span class="name">upvoter</span><span class="operator">.</span><span class="name">upvote_num</span><span class="punctuation">,</span> <span class="name">upvoter</span><span class="operator">.</span><span class="name">thank_num</span><span class="punctuation">,</span>
          <span class="name">upvoter</span><span class="operator">.</span><span class="name">question_num</span><span class="punctuation">,</span> <span class="name">upvoter</span><span class="operator">.</span><span class="name">answer_num</span><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="name">upvoter</span><span class="operator">.</span><span class="name">is_zero_user</span><span class="punctuation">():</span>
        <span class="name">three_zero_user_num</span> <span class="operator">+=</span> <span class="literal number integer">1</span>

<span class="keyword">print</span><span class="punctuation">(</span><span class="literal string">'</span><span class="literal string escape">\n</span><span class="literal string">三零用户比例 </span><span class="literal string interpol">%.3f%%</span><span class="literal string">'</span> <span class="operator">%</span> <span class="punctuation">(</span><span class="name">three_zero_user_num</span> <span class="operator">/</span> <span class="name">answer</span><span class="operator">.</span><span class="name">upvote_num</span> <span class="operator">*</span> <span class="literal number integer">100</span><span class="punctuation">))</span>
</pre>
<p>结果：</p>
<pre class="literal-block">
...
宋飞 0 0 0 0
唐吃藕 10 0 0 5

三零用户比例 26.852%
</pre>
</div>
<div class="section" id="id11">
<h2>爬取某用户关注的人的头像</h2>
<pre class="code python literal-block">
<span class="keyword namespace">import</span> <span class="name namespace">requests</span>
<span class="keyword namespace">import</span> <span class="name namespace">os</span>
<span class="keyword namespace">import</span> <span class="name namespace">imghdr</span>

<span class="name">author</span> <span class="operator">=</span> <span class="name">client</span><span class="operator">.</span><span class="name">author</span><span class="punctuation">(</span><span class="literal string">'http://www.zhihu.com/people/zord-vczh'</span><span class="punctuation">)</span>

<span class="name">os</span><span class="operator">.</span><span class="name">mkdir</span><span class="punctuation">(</span><span class="literal string">'vczh'</span><span class="punctuation">)</span>
<span class="keyword">for</span> <span class="name">followee</span> <span class="operator word">in</span> <span class="name">author</span><span class="operator">.</span><span class="name">followees</span><span class="punctuation">:</span>
    <span class="keyword">try</span><span class="punctuation">:</span>
        <span class="name">filename</span> <span class="operator">=</span> <span class="name">followee</span><span class="operator">.</span><span class="name">name</span> <span class="operator">+</span> <span class="literal string">' - '</span> <span class="operator">+</span> <span class="name">followee</span><span class="operator">.</span><span class="name">id</span> <span class="operator">+</span> <span class="literal string">'.jpeg'</span>
        <span class="keyword">print</span><span class="punctuation">(</span><span class="name">filename</span><span class="punctuation">)</span>
        <span class="keyword">with</span> <span class="name builtin">open</span><span class="punctuation">(</span><span class="literal string">'vczh/'</span> <span class="operator">+</span> <span class="name">filename</span><span class="punctuation">,</span> <span class="literal string">'wb'</span><span class="punctuation">)</span> <span class="keyword">as</span> <span class="name">f</span><span class="punctuation">:</span>
            <span class="name">f</span><span class="operator">.</span><span class="name">write</span><span class="punctuation">(</span><span class="name">requests</span><span class="operator">.</span><span class="name">get</span><span class="punctuation">(</span><span class="name">followee</span><span class="operator">.</span><span class="name">photo_url</span><span class="punctuation">)</span><span class="operator">.</span><span class="name">content</span><span class="punctuation">)</span>
    <span class="keyword">except</span> <span class="name exception">KeyboardInterrupt</span><span class="punctuation">:</span>
        <span class="keyword">break</span>

<span class="keyword">for</span> <span class="name">root</span><span class="punctuation">,</span> <span class="name">dirs</span><span class="punctuation">,</span> <span class="name">files</span> <span class="operator word">in</span> <span class="name">os</span><span class="operator">.</span><span class="name">walk</span><span class="punctuation">(</span><span class="literal string">'vczh'</span><span class="punctuation">):</span>
    <span class="keyword">for</span> <span class="name">filename</span> <span class="operator word">in</span> <span class="name">files</span><span class="punctuation">:</span>
        <span class="name">filename</span> <span class="operator">=</span> <span class="name">os</span><span class="operator">.</span><span class="name">path</span><span class="operator">.</span><span class="name">join</span><span class="punctuation">(</span><span class="name">root</span><span class="punctuation">,</span> <span class="name">filename</span><span class="punctuation">)</span>
        <span class="name">img_type</span> <span class="operator">=</span> <span class="name">imghdr</span><span class="operator">.</span><span class="name">what</span><span class="punctuation">(</span><span class="name">filename</span><span class="punctuation">)</span>
        <span class="keyword">if</span> <span class="name">img_type</span> <span class="operator">!=</span> <span class="literal string">'jpeg'</span> <span class="operator word">and</span> <span class="name">img_type</span> <span class="operator word">is</span> <span class="operator word">not</span> <span class="name builtin pseudo">None</span><span class="punctuation">:</span>
            <span class="keyword">print</span><span class="punctuation">(</span><span class="name">filename</span><span class="punctuation">,</span> <span class="literal string">'---&gt;'</span><span class="punctuation">,</span> <span class="name">img_type</span><span class="punctuation">)</span>
            <span class="name">os</span><span class="operator">.</span><span class="name">rename</span><span class="punctuation">(</span><span class="name">filename</span><span class="punctuation">,</span> <span class="name">filename</span><span class="punctuation">[:</span><span class="operator">-</span><span class="literal number integer">4</span><span class="punctuation">]</span> <span class="operator">+</span> <span class="name">img_type</span><span class="punctuation">)</span>
</pre>
<p>结果：</p>
<p><a class="reference external" href="http://www.zhihu.com/question/28661987/answer/42591825">点这里</a></p>
</div>
</div>
<div class="section" id="zhihuclient">
<h1>登录相关方法（均为<tt class="docutils literal">ZhihuClient</tt>的方法）</h1>
<div class="section" id="create-cookies">
<h2>create_cookies</h2>
<p>用于生成 cookies，用法见前面的介绍。</p>
</div>
<div class="section" id="login-with-cookies">
<h2>login_with_cookies</h2>
<p>用cookies字符串或文件名登录，<tt class="docutils literal">ZhihuClient</tt>的构造函数就是使用这个方法。</p>
</div>
<div class="section" id="get-captcha">
<h2>get_captcha</h2>
<p>获取验证码数据（bytes二进制数据），当用于其他项目时方便手动获取验证码图片数据进行处理，比如显示在控件内。</p>
</div>
<div class="section" id="login">
<h2>login</h2>
<p>手动登陆方法，用于其他项目中方便手动无需 cookies 登陆，参数为：</p>
<ul class="simple">
<li>email</li>
<li>password</li>
<li>captcha</li>
</ul>
<p>返回值有三个</p>
<ul class="simple">
<li>code：成功为0，失败为1</li>
<li>msg：错误消息，字符串格式，成功为空</li>
<li>cookies：cookies数据，字符串格式，失败为空</li>
</ul>
</div>
<div class="section" id="login-in-terminal">
<h2>login_in_terminal</h2>
<p>跟着提示在终端里登录知乎，返回cookies字符串，create_cookies就是帮你做了将这个函数的返回值保存下来的工作而已。</p>
</div>
<div class="section" id="id12">
<h2>综上</h2>
<p>如果你只是写个小脚本测试玩玩，可以使用：</p>
<pre class="code python literal-block">
<span class="keyword namespace">from</span> <span class="name namespace">zhihu</span> <span class="keyword namespace">import</span> <span class="name">ZhihuClient</span>
<span class="name">client</span> <span class="operator">=</span> <span class="name">ZhiuhClien</span><span class="punctuation">()</span>
<span class="name">client</span><span class="operator">.</span><span class="name">login_in_terminal</span><span class="punctuation">()</span>

<span class="comment"># do thing you want with client</span>
</pre>
<p>如果你的脚本不是大项目，又要多次运行，可以先按照上文方法create_cookies，再使用：</p>
<pre class="code python literal-block">
<span class="keyword namespace">from</span> <span class="name namespace">zhihu</span> <span class="keyword namespace">import</span> <span class="name">ZhihuClient</span>
<span class="name">Cookies_File</span> <span class="operator">=</span> <span class="literal string">'cookies.json'</span>
<span class="name">client</span> <span class="operator">=</span> <span class="name">ZhihuClient</span><span class="punctuation">(</span><span class="name">Cookies_File</span><span class="punctuation">)</span>
</pre>
<p>如果项目比较大（以GUI项目为例），可以在判断出是首次使用（没有cookies文件）时，弹出登录对话框，使用get_captcha获取验证码数据，再调用login函数手动登录并在登录成功后保存cookies文件：</p>
<pre class="code python literal-block">
<span class="keyword namespace">import</span> <span class="name namespace">os</span>
<span class="keyword namespace">from</span> <span class="name namespace">zhihu</span> <span class="keyword namespace">import</span> <span class="name">ZhihuClient</span>

<span class="name">Cookies_File</span> <span class="operator">=</span> <span class="literal string">'config/cookies.json'</span>

<span class="name">client</span> <span class="operator">=</span> <span class="name">ZhihuClient</span><span class="punctuation">()</span>

<span class="keyword">def</span> <span class="name function">on_window_show</span><span class="punctuation">()</span>
    <span class="name">login_btn</span><span class="operator">.</span><span class="name">disable</span><span class="punctuation">()</span>
    <span class="keyword">if</span> <span class="name">os</span><span class="operator">.</span><span class="name">path</span><span class="operator">.</span><span class="name">isfile</span><span class="punctuation">(</span><span class="name">Cookies_File</span><span class="punctuation">)</span> <span class="operator word">is</span> <span class="name builtin pseudo">False</span><span class="punctuation">:</span>
        <span class="name">captcha_imgbox</span><span class="operator">.</span><span class="name">setData</span><span class="punctuation">(</span><span class="name">client</span><span class="operator">.</span><span class="name">get_capthca</span><span class="punctuation">())</span>
        <span class="name">login_btn</span><span class="operator">.</span><span class="name">enable</span><span class="punctuation">()</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="keyword">with</span> <span class="name builtin">open</span><span class="punctuation">(</span><span class="name">Cookies_File</span><span class="punctuation">)</span> <span class="keyword">as</span> <span class="name">f</span>
            <span class="name">client</span><span class="operator">.</span><span class="name">login_with_cookies</span><span class="punctuation">(</span><span class="name">f</span><span class="operator">.</span><span class="name">read</span><span class="punctuation">())</span>
        <span class="comment"># turn to main window</span>

<span class="keyword">def</span> <span class="name function">on_login_button_clicked</span><span class="punctuation">():</span>
    <span class="name">login_btn</span><span class="operator">.</span><span class="name">disable</span><span class="punctuation">()</span>
    <span class="name">email</span> <span class="operator">=</span> <span class="name">email_edit</span><span class="operator">.</span><span class="name">get_text</span><span class="punctuation">()</span>
    <span class="name">password</span> <span class="operator">=</span> <span class="name">password_edit</span><span class="operator">.</span><span class="name">get_text</span><span class="punctuation">()</span>
    <span class="name">captcha</span> <span class="operator">=</span> <span class="name">captcha_edit</span><span class="operator">.</span><span class="name">get_text</span><span class="punctuation">()</span>
    <span class="name">code</span><span class="punctuation">,</span> <span class="name">msg</span><span class="punctuation">,</span> <span class="name">cookies</span> <span class="operator">=</span> <span class="name">clien</span><span class="operator">.</span><span class="name">login</span><span class="punctuation">(</span><span class="name">email</span><span class="punctuation">,</span> <span class="name">password</span><span class="punctuation">,</span> <span class="name">captcha</span><span class="punctuation">)</span>
    <span class="keyword">if</span> <span class="name">code</span> <span class="operator">==</span> <span class="literal number integer">0</span><span class="punctuation">:</span>
        <span class="keyword">with</span> <span class="name builtin">open</span><span class="punctuation">(</span><span class="name">Cookies_File</span><span class="punctuation">,</span> <span class="literal string">'w'</span><span class="punctuation">)</span> <span class="keyword">as</span> <span class="name">f</span>
            <span class="name">f</span><span class="operator">.</span><span class="name">write</span><span class="punctuation">(</span><span class="name">cookies</span><span class="punctuation">)</span>
        <span class="comment"># turn to main window</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="name">msgbox</span><span class="punctuation">(</span><span class="name">msg</span><span class="punctuation">)</span>
        <span class="name">login_btn</span><span class="operator">.</span><span class="name">enable</span><span class="punctuation">()</span>
</pre>
<p>注：以上和GUI有关的代码皆为我乱想出来的，仅作示例之用。</p>
</div>
</div>
<div class="section" id="id13">
<h1>文档</h1>
<p>终于搞定了文档这个磨人的小妖精，可惜 Sphinx 还是不会用 T^T
先随意弄成这样吧：</p>
<p>Read The Docs：
<a class="reference external" href="http://zhihu-py3.readthedocs.org/zh_CN/latest">点击这里查看文档</a></p>
</div>
<div class="section" id="todo-list">
<h1>TODO List</h1>
<ul class="simple">
<li>[x] 增加获取用户关注者，用户追随者</li>
<li>[x] 增加获取答案点赞用户功能</li>
<li>[x] 获取用户头像地址</li>
<li>[x] 打包为标准Python模块</li>
<li>[x] 重构代码，增加<tt class="docutils literal">ZhihuClient</tt>类，使类可以自定义cookies文件</li>
<li>[ ] 收藏夹关注者，问题关注者等等</li>
<li>[ ] <tt class="docutils literal">ZhihuClient</tt>增加各种用户操作（比如给某答案点赞）</li>
</ul>
</div>
<div class="section" id="id14">
<h1>联系我</h1>
<p>Github：<a class="reference external" href="https://github.com/7sDream">&#64;7sDream</a></p>
<p>知乎：<a class="reference external" href="http://www.zhihu.com/people/7sdream">&#64;7sDream</a></p>
<p>新浪微博：<a class="reference external" href="http://weibo.com/didilover">&#64;Dilover</a></p>
<p>邮箱：<a class="reference external" href="mailto:xixihaha.xiha&#64;qq.com">给我发邮件</a></p>
<p>编程交流群：478786205</p>
</div>
</div>
</body>
</html>
